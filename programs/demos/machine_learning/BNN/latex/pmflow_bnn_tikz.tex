\documentclass[tikz,border=6pt]{standalone}
\usepackage{tikz}
\usetikzlibrary{arrows.meta,positioning,calc,decorations.pathmorphing,shapes.geometric}

\begin{document}
% Color palette
\definecolor{sens}{RGB}{0,120,200}
\definecolor{latent}{RGB}{220,120,0}
\definecolor{flow}{RGB}{200,60,60}
\definecolor{inh}{RGB}{80,80,80}
\definecolor{act}{RGB}{0,150,80}
\definecolor{read}{RGB}{120,0,180}
\definecolor{plast}{RGB}{150,75,0}
\definecolor{gridc}{RGB}{180,180,180}

\begin{tikzpicture}[>=Latex, line width=0.8pt, node distance=10mm]

% Title
\node[align=center] (title) {\Large PMFlow-based Biological Neural Network};

% Sensory input block
\node[draw, rounded corners, fill=sens!10, inner sep=6pt, below=10mm of title] (input) {%
\begin{minipage}{5.5cm}\centering
\textbf{Sensory input} $\mathbf{I}(\mathbf{z},t)$\\
(topographic channels / boundary drive)
\end{minipage}};

% Latent sheet container
\node[draw, rounded corners, fill=latent!6, inner sep=6pt, right=18mm of input, minimum width=9.5cm, minimum height=6.2cm] (sheetbox) {};

% Label for latent sheet
\node[anchor=north west] at ($(sheetbox.north west)+(4pt,-4pt)$) {\small \textbf{Cortical sheet latent space} $\mathbf{z}\in\mathbb{R}^d$};

% Draw a deformed grid to suggest manifold
\begin{scope}
\clip (sheetbox.south west) rectangle (sheetbox.north east);
\foreach \x in {0.5,1.2,...,9.0}{
  \draw[gridc] ($(sheetbox.south west)+( \x,0.5)$) .. controls ($(sheetbox.south west)+( \x+0.1,2.0)$) and ($(sheetbox.south west)+( \x-0.2,3.5)$) .. ($(sheetbox.south west)+( \x,5.5)$);
}
\foreach \y in {0.8,1.6,...,5.4}{
  \draw[gridc] ($(sheetbox.south west)+(0.5,\y)$) .. controls ($(sheetbox.south west)+(2.5,\y+0.2)$) and ($(sheetbox.south west)+(6.5,\y-0.2)$) .. ($(sheetbox.south west)+(9.0,\y)$);
}
\end{scope}

% PM flow centers (attractors/repulsors)
\foreach \px/\py/\mu in {1.3/1.2/+, 2.8/2.0/+, 4.6/1.7/+, 3.6/3.8/-, 6.8/2.8/+, 7.8/4.4/-}{
  \node[circle, draw=flow!70, fill=flow!15, minimum size=6mm, inner sep=0pt] (c\px\py) at ($(sheetbox.south west)+(\px,\py)$) {};
  \node at ($(sheetbox.south west)+(\px,\py)$) {\small \textbf{\mu}};
  \node[anchor=south, scale=0.6] at ($(sheetbox.south west)+(\px,\py)+(0,0.45)$) {\(\mu\,\)\ifx\mu+\(+\)\else\(-\)\fi};
}

% Flow field arrows (few samples)
\foreach \ax/\ay in {1.2/2.0, 2.2/3.0, 3.2/2.7, 4.0/1.0, 5.5/2.4, 6.6/3.6, 7.5/2.0, 8.4/4.2}{
  \draw[->, flow!85] ($(sheetbox.south west)+(\ax,\ay)$) .. controls ++(0.6,0.2) and ++(-0.6,-0.1) .. ($(sheetbox.south west)+(\ax+0.9,\ay+0.4)$);
}

% Activity particles on sheet
\foreach \qx/\qy in {1.6/1.8, 2.4/2.5, 3.0/3.2, 4.2/2.2, 5.8/3.0, 6.9/2.2, 7.6/3.7, 8.2/2.6}{
  \node[circle, draw=act!70, fill=act!20, minimum size=3.5mm] at ($(sheetbox.south west)+(\qx,\qy)$) {};
}

% Lateral E-I label
\node[draw, rounded corners, fill=inh!8, inner sep=4pt, above right=1mm and -2mm of sheetbox.south west] (ei) {\small Lateral E--I kernel $\mathcal{K}=\;K_E\mathcal{N}(\sigma_E)-K_I\mathcal{N}(\sigma_I)$};

% Advection and EI arrows to annotate
\node[anchor=north east, flow!85] (advL) at ($(sheetbox.north east)+(-2.0cm,-0.6cm)$) {\small Advection by PM flow};
\draw[->, flow!85] (advL.west) -- ++(-1.0, -0.1);

\node[anchor=north east, inh!85] (eiL) at ($(sheetbox.north east)+(-1.9cm,-1.6cm)$) {\small Lateral competition};
\draw[->, inh!85] (eiL.west) -- ++(-1.1, -0.2);

% Readout block
\node[draw, rounded corners, fill=read!10, minimum width=3.6cm, right=14mm of sheetbox] (readout) {%
\begin{minipage}{3.2cm}\centering
\textbf{Readout}\\
$y(t)=\mathrm{softmax}(W\,\phi(\mathbf{h}))$
\end{minipage}};

% Plasticity block
\node[draw, rounded corners, fill=plast!10, minimum width=3.8cm, above=6mm of readout] (plast) {%
\begin{minipage}{3.4cm}\centering
\textbf{Local plasticity}\\
Hebbian $\Delta \mu, \Delta \mathbf{c}$\\
Homeostasis $\Delta K_I$\\
STDP $\Delta \mathcal{K}$
\end{minipage}};

% Input -> sheet
\draw[->, sens!85] (input.east) -- node[above, sloped, pos=0.55, sens!85] {\small boundary drive $B\,\mathbf{I}(\mathbf{z},t)$} (sheetbox.west);

% Sheet -> Readout
\draw[->, read!85] (sheetbox.east) -- node[above, sloped, pos=0.5, read!85] {\small population activity $\mathbf{h}(\mathbf{z},t)$} (readout.west);

% Plasticity arrows (feedback to centers and kernel)
\draw[->, plast!85] (plast.west) to[bend left=15] node[above, sloped, pos=0.5, plast!85] {\small update $\{\mu,\mathbf{c}\}$} ($(sheetbox.north west)+(2.0cm,-0.8cm)$);
\draw[->, plast!85] (plast.south) -- ++(0,-0.8) -| node[pos=0.25, right, plast!85] {\small update $\mathcal{K},K_I$} ($(sheetbox.south)+(0,0.0)$);

% Legend
\node[draw, rounded corners, inner sep=4pt, below=8mm of sheetbox] (legend) {%
\begin{tikzpicture}[baseline]
  \draw[sens, -{Latex}] (0,0) -- (1,0); \node[right] at (1.2,0) {\small Sensory input};
  \draw[flow, -{Latex}] (4.2,0) -- (5.2,0); \node[right] at (5.4,0) {\small PM flow (advection)};
  \draw[inh, -{Latex}] (0,-0.6) -- (1,-0.6); \node[right] at (1.2,-0.6) {\small Lateral E--I};
  \draw[read, -{Latex}] (4.2,-0.6) -- (5.2,-0.6); \node[right] at (5.4,-0.6) {\small Readout};
  \draw[plast, -{Latex}] (0,-1.2) -- (1,-1.2); \node[right] at (1.2,-1.2) {\small Plasticity updates};
  \draw[act] (4.2,-1.35) circle (1.8pt); \node[right] at (5.0,-1.2) {\small Activity parcels on sheet};
\end{tikzpicture}
};

\end{tikzpicture}
\end{document}

